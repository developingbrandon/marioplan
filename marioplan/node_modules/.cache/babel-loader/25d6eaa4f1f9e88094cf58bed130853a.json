{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: !0\n}), exports.getVal = getVal, exports.isLoaded = isLoaded, exports.isEmpty = isEmpty, exports.fixPath = fixPath, exports.populate = populate;\n\nvar _some2 = _interopRequireDefault(require(\"lodash/some\")),\n    _defaultsDeep2 = _interopRequireDefault(require(\"lodash/defaultsDeep\")),\n    _reduce2 = _interopRequireDefault(require(\"lodash/reduce\")),\n    _mapValues2 = _interopRequireDefault(require(\"lodash/mapValues\")),\n    _map2 = _interopRequireDefault(require(\"lodash/map\")),\n    _has2 = _interopRequireDefault(require(\"lodash/has\")),\n    _get2 = _interopRequireDefault(require(\"lodash/get\")),\n    _set2 = _interopRequireDefault(require(\"lodash/set\")),\n    _size2 = _interopRequireDefault(require(\"lodash/size\")),\n    _constants = require(\"./constants\"),\n    _populate = require(\"./utils/populate\"),\n    _reducers = require(\"./utils/reducers\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || \"[object Arguments]\" === Object.prototype.toString.call(iter)) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i];\n\n    return arr2;\n  }\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var source, i = 1; i < arguments.length; i++) source = null == arguments[i] ? {} : arguments[i], i % 2 ? ownKeys(source, !0).forEach(function (key) {\n    _defineProperty(target, key, source[key]);\n  }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(source).forEach(function (key) {\n    Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n  });\n\n  return target;\n}\n\nfunction _defineProperty(obj, key, value) {\n  return key in obj ? Object.defineProperty(obj, key, {\n    value: value,\n    enumerable: !0,\n    configurable: !0,\n    writable: !0\n  }) : obj[key] = value, obj;\n}\n\nfunction getVal(firebase, path, notSetValue) {\n  if (!firebase) return notSetValue;\n  var dotPath = (0, _reducers.getDotStrPath)(path),\n      valueAtPath = (0, _get2.default)(firebase, dotPath, notSetValue);\n  return valueAtPath;\n}\n\nfunction isLoaded() {\n  for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) args[_key] = arguments[_key];\n\n  return !(args && args.length) || args.every(function (arg) {\n    return arg !== void 0 && !1 !== (0, _get2.default)(arg, \"isLoaded\");\n  });\n}\n\nfunction isEmpty() {\n  for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) args[_key2] = arguments[_key2];\n\n  return !(args && args.length) || args.some(function (arg) {\n    return !(arg && (0, _size2.default)(arg)) || !0 === arg.isEmpty;\n  });\n}\n\nfunction fixPath(path) {\n  return (\"/\" === path.substring(0, 1) ? \"\" : \"/\") + path;\n}\n\nfunction buildChildList(state, list, p) {\n  return (0, _mapValues2.default)(list, function (val, key) {\n    var getKey = val;\n    (!0 === val || p.populateByKey) && (getKey = key);\n    var dotRoot = (0, _reducers.getDotStrPath)(p.root),\n        pathArr = [dotRoot, getKey];\n    p.childParam && pathArr.push(p.childParam);\n    var pathString = pathArr.join(\".\");\n    return (0, _get2.default)(state.data, pathString) ? p.keyProp ? _objectSpread(_defineProperty({}, p.keyProp, getKey), (0, _get2.default)(state.data, pathString)) : (0, _get2.default)(state.data, pathString) : !0 === val || p.populateByKey ? val : getKey;\n  });\n}\n\nfunction populateChild(state, child, p) {\n  var childVal = (0, _get2.default)(child, p.child);\n  if (!child || !childVal) return null;\n\n  if (\"string\" == typeof childVal || childVal instanceof String) {\n    var dotRoot = p.root.split(\"/\").filter(Boolean).join(\".\"),\n        pathArr = [dotRoot, childVal];\n    p.childParam && pathArr.push(p.childParam);\n    var pathString = pathArr.join(\".\"),\n        populateVal = (0, _get2.default)(state.data, pathString);\n    return populateVal ? (0, _set2.default)({}, p.childAlias || p.child, p.keyProp ? _objectSpread(_defineProperty({}, p.keyProp, childVal), populateVal) : populateVal) : child;\n  }\n\n  return (0, _set2.default)({}, p.childAlias || p.child, buildChildList(state, childVal, p));\n}\n\nfunction populate(state, path, populates, notSetValue) {\n  var splitPath = path.split(\"/\").filter(Boolean),\n      pathArr = -1 === _constants.topLevelPaths.indexOf(splitPath[0]) ? [\"data\"].concat(_toConsumableArray(splitPath)) : splitPath,\n      dotPath = pathArr.join(\".\"),\n      data = (0, _get2.default)(state, dotPath, notSetValue);\n  if (!state || data === notSetValue) return notSetValue;\n  if (null === data) return null;\n  var populatesForData = (0, _populate.getPopulateObjs)(\"function\" == typeof populates ? populates(pathArr.slice(-1)[0], data) : populates);\n\n  if (Array.isArray(data)) {\n    var someArrayItemHasKey = function (array) {\n      return function (key) {\n        return (0, _some2.default)(array, function (item) {\n          return (0, _has2.default)(item, key);\n        });\n      };\n    },\n        _dataHasPopulateChilds = (0, _some2.default)(populatesForData, function (populate) {\n      return someArrayItemHasKey(data)([\"value\", populate.child]);\n    });\n\n    return _dataHasPopulateChilds ? data.map(function (_ref) {\n      var key = _ref.key,\n          dataValue = _ref.value,\n          populatedValue = populatesForData.map(function (p) {\n        return populateChild(state, dataValue, p);\n      }).reduce(function (acc, v) {\n        return (0, _defaultsDeep2.default)(v, acc);\n      }, dataValue);\n      return {\n        key: key,\n        value: populatedValue\n      };\n    }) : data;\n  }\n\n  var dataHasPopulateChilds = (0, _some2.default)(populatesForData, function (p) {\n    return (0, _has2.default)(data, p.child);\n  });\n  return dataHasPopulateChilds ? populatesForData.map(function (p) {\n    return populateChild(state, data, p);\n  }).reduce(function (acc, v) {\n    return (0, _defaultsDeep2.default)(v, acc);\n  }, data) : -1 === pathArr.indexOf(\"profile\") ? (0, _mapValues2.default)(data, function (child, childKey) {\n    var key = \"ordered\" === pathArr[0] ? child.key : childKey,\n        populatesForDataItem = (0, _populate.getPopulateObjs)(\"function\" == typeof populates ? populates(key, child) : populates),\n        dataHasPopulateChilds = (0, _some2.default)(populatesForDataItem, function (p) {\n      return (0, _has2.default)(child, p.child);\n    });\n    return dataHasPopulateChilds ? (0, _reduce2.default)((0, _map2.default)(populatesForDataItem, function (p) {\n      return populateChild(state, child, p);\n    }), function (obj, v) {\n      return (0, _defaultsDeep2.default)(v, obj);\n    }, child) : child;\n  }) : data;\n}","map":null,"metadata":{},"sourceType":"script"}